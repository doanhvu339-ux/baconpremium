-- Float Menu LocalScript

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local player = Players.LocalPlayer

-- UI
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "FloatMenuGui"
screenGui.ResetOnSpawn = false
screenGui.Parent = player:WaitForChild("PlayerGui")

local frame = Instance.new("Frame")
frame.Name = "MainFrame"
frame.Size = UDim2.new(0, 220, 0, 120)
frame.Position = UDim2.new(0.05, 0, 0.2, 0)
frame.BackgroundColor3 = Color3.fromRGB(173, 216, 230) -- xanh dương nhạt
frame.BorderSizePixel = 0
frame.Parent = screenGui

-- Bo góc frame
local frameCorner = Instance.new("UICorner")
frameCorner.CornerRadius = UDim.new(0, 10)
frameCorner.Parent = frame

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1,0,0,28)
title.BackgroundTransparency = 1
title.Text = "Float Menu"
title.Font = Enum.Font.GothamBold
title.TextSize = 16
title.TextColor3 = Color3.new(0,0,0)
title.Parent = frame

local closeBtn = Instance.new("TextButton")
closeBtn.Size = UDim2.new(0,22,0,22)
closeBtn.Position = UDim2.new(1,-26,0,4)
closeBtn.Text = "X"
closeBtn.Font = Enum.Font.SourceSansBold
closeBtn.TextSize = 14
closeBtn.TextColor3 = Color3.new(1,1,1)
closeBtn.Parent = frame
closeBtn.BackgroundColor3 = Color3.fromRGB(200,80,80)
closeBtn.BorderSizePixel = 0
local closeCorner = Instance.new("UICorner")
closeCorner.CornerRadius = UDim.new(1, 0)
closeCorner.Parent = closeBtn

local toggleBtn = Instance.new("TextButton")
toggleBtn.Size = UDim2.new(0, 120, 0, 36)
toggleBtn.Position = UDim2.new(0.5, -60, 0.5, -18) -- căn giữa
toggleBtn.Text = "Float: OFF"
toggleBtn.Font = Enum.Font.Gotham
toggleBtn.TextSize = 14
toggleBtn.TextColor3 = Color3.new(0,0,0)
toggleBtn.Parent = frame
toggleBtn.BackgroundColor3 = Color3.fromRGB(144, 200, 255) -- xanh dương nhạt hơn
toggleBtn.BorderSizePixel = 0
local toggleCorner = Instance.new("UICorner")
toggleCorner.CornerRadius = UDim.new(0, 8)
toggleCorner.Parent = toggleBtn

-- Drag logic (chuột + cảm ứng)
local dragging, dragInput, dragStart, startPos

local function update(input)
    local delta = input.Position - dragStart
    frame.Position = UDim2.new(
        startPos.X.Scale,
        startPos.X.Offset + delta.X,
        startPos.Y.Scale,
        startPos.Y.Offset + delta.Y
    )
end

frame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 
    or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = frame.Position

        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

frame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement 
    or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        update(input)
    end
end)

-- Float logic
local isFloating = false
local floatOffset = 3.5
local platform, keepUpdating

local function createPlatform()
    if platform and platform.Parent then return end
    platform = Instance.new("Part")
    platform.Name = "FloatPlatform_" .. player.Name
    platform.Size = Vector3.new(10, 1, 10)
    platform.Anchored = true
    platform.CanCollide = true
    platform.Transparency = 1
    platform.Parent = workspace
end

local function enableFloat()
    local char = player.Character
    if not char then return end
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end
    createPlatform()
    keepUpdating = true
    task.spawn(function()
        while keepUpdating do
            if not (platform and hrp and hrp.Parent) then break end
            platform.Position = hrp.Position - Vector3.new(0, floatOffset, 0)
            RunService.Heartbeat:Wait()
        end
    end)
end

local function disableFloat()
    keepUpdating = false
    if platform then
        pcall(function() platform:Destroy() end)
        platform = nil
    end
end

-- Button logic
toggleBtn.MouseButton1Click:Connect(function()
    isFloating = not isFloating
    if isFloating then
        toggleBtn.Text = "Float: ON"
        enableFloat()
    else
        toggleBtn.Text = "Float: OFF"
        disableFloat()
    end
end)

closeBtn.MouseButton1Click:Connect(function()
    screenGui:Destroy()
    disableFloat()
end)

-- Respawn handling
player.CharacterRemoving:Connect(function()
    disableFloat()
end)

player.CharacterAdded:Connect(function()
    if isFloating then
        task.wait(1)
        enableFloat()
    end
end)

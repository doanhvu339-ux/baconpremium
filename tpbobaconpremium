local player = game.Players.LocalPlayer
local UIS = game:GetService("UserInputService")

-- GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "DragTPGui"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = player:WaitForChild("PlayerGui")

local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0, 220, 0, 160)
Frame.Position = UDim2.new(0.5, -110, 0.5, -80)
Frame.BackgroundColor3 = Color3.fromRGB(135, 206, 250) -- Sky blue
Frame.Active = true
Frame.Parent = ScreenGui

-- Bo góc
local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 10)
UICorner.Parent = Frame

-- Tiêu đề
local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 30)
Title.BackgroundTransparency = 1
Title.Text = "Teleport Menu"
Title.Font = Enum.Font.SourceSansBold
Title.TextSize = 20
Title.TextColor3 = Color3.fromRGB(0, 0, 0) -- chữ đen
Title.Parent = Frame

-- Kéo thả
local dragging, dragInput, dragStart, startPos
local function update(input)
    local delta = input.Position - dragStart
    Frame.Position = UDim2.new(
        startPos.X.Scale, startPos.X.Offset + delta.X,
        startPos.Y.Scale, startPos.Y.Offset + delta.Y
    )
end
Frame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = Frame.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)
Frame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)
UIS.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        update(input)
    end
end)

-- Layout
local UIListLayout = Instance.new("UIListLayout")
UIListLayout.FillDirection = Enum.FillDirection.Vertical
UIListLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
UIListLayout.VerticalAlignment = Enum.VerticalAlignment.Center
UIListLayout.Padding = UDim.new(0,8)
UIListLayout.Parent = Frame

-- Biến lưu vị trí
local savedPosition = nil

-- Hàm tạo nút
local function createButton(text)
    local button = Instance.new("TextButton")
    button.Size = UDim2.new(0, 180, 0, 40)
    button.BackgroundColor3 = Color3.fromRGB(255, 255, 255) -- nền trắng
    button.TextColor3 = Color3.fromRGB(0, 0, 0) -- chữ đen
    button.Text = text
    button.Font = Enum.Font.SourceSansBold
    button.TextSize = 18

    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = button

    -- Hover effect
    button.MouseEnter:Connect(function()
        button.BackgroundColor3 = Color3.fromRGB(230, 230, 230)
    end)
    button.MouseLeave:Connect(function()
        button.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    end)

    button.Parent = Frame
    return button
end

-- Nút đặt vị trí
local setPosButton = createButton("Đặt vị trí TP")
setPosButton.MouseButton1Click:Connect(function()
    local character = player.Character
    if character and character:FindFirstChild("HumanoidRootPart") then
        savedPosition = character.HumanoidRootPart.Position
        setPosButton.Text = "Vị trí đã đặt!"
        task.delay(1.2, function()
            setPosButton.Text = "Đặt vị trí TP"
        end)
    end
end)

-- Nút TP
local canTP = true
local tpButton = createButton("TP đến vị trí")
tpButton.MouseButton1Click:Connect(function()
    if not canTP then return end
    canTP = false

    local character = player.Character
    if character and character:FindFirstChild("HumanoidRootPart") and savedPosition then
        character.HumanoidRootPart.CFrame = CFrame.new(savedPosition)
        tpButton.Text = "Đã dịch chuyển!"
    else
        tpButton.Text = "Chưa đặt vị trí!"
    end

    task.delay(0.6, function() -- text reset sau 0.6s
        tpButton.Text = "TP đến vị trí"
    end)

    task.delay(0.2, function() -- cooldown 0.2s
        canTP = true
    end)
end)
